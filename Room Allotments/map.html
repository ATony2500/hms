<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Building Room Map</title>
     <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #fdfdfd;
        min-height: 100vh;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: black;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
      }

      .building-map {
        background-color: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      .floor-selector {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .floor-btn {
        padding: 10px 20px;
        border: 2px solid #667eea;
        background-color: white;
        color: #667eea;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .floor-btn.active {
        background-color: #667eea;
        color: white;
      }

      .floor-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .floor-title {
        text-align: center;
        font-size: 1.8em;
        color: #333;
        margin-bottom: 20px;
        font-weight: 600;
      }

      .rooms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
      }

      .room {
        aspect-ratio: 1;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        color: white;
        border: 2px solid transparent;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .room:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .room-number {
        font-size: 1.3em;
        margin-bottom: 5px;
      }

      .room-type {
        font-size: 0.8em;
        opacity: 0.9;
      }

      .room.available {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      }

      .room.occupied {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      }

      .room.icu {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      }

      .sidebar {
        background-color: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        height: fit-content;
      }

      .sidebar h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.3em;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .legend {
        margin-bottom: 25px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
      }

      .legend-color {
        width: 30px;
        height: 30px;
        border-radius: 5px;
        margin-right: 10px;
      }

      .legend-color.available {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      }

      .legend-color.occupied {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      }

      .legend-color.icu {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      }

      .legend-text {
        color: #555;
        font-size: 0.9em;
      }

      .room-info {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 4px solid #667eea;
      }

      .room-info h3 {
        color: #333;
        margin-bottom: 8px;
      }

      .room-info p {
        color: #666;
        font-size: 0.9em;
        margin: 5px 0;
      }

      .stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 20px;
        font-size: 0.9em;
      }

      .stat-item {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
      }

      .stat-label {
        color: #666;
        font-size: 0.8em;
      }

      .stat-value {
        color: #333;
        font-weight: 600;
        font-size: 1.2em;
      }

      .back-btn {
        display: inline-block;
        margin-top: 80px; 
        margin-bottom: 20px;
        padding: 10px 20px;
        background-color: #1f314a;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: all 0.3s;
        border: 2px solid white;
      }

      .back-btn:hover {
        background-color:#15202f;
      }

      @media (max-width: 768px) {
        .container {
          grid-template-columns: 1fr;
        }

        .building-map {
          grid-column: 1;
        }

        .sidebar {
          grid-column: 1;
        }
      }
    </style>
  </head>
  <body>
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.php">
          <i class="bi bi-hospital"></i> Hospital Management System
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="../dashboard.php"
                ><i class="bi bi-speedometer2"></i> Dashboard</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../patients.php"
                ><i class="bi bi-people"></i> Patients</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../doctors.php"
                ><i class="bi bi-person-badge"></i> Doctors</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../appointments.php"
                ><i class="bi bi-calendar-check"></i> Appointments</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html"
                ><i class="bi bi-house-door"></i> Room Allotments</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../payments.php"
                ><i class="bi bi-currency-dollar"></i> Payments</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../logout.php"
                ><i class="bi bi-box-arrow-right"></i> Logout</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <a href="index.html" class="back-btn">‚Üê Back to Home</a>

    <div class="header">
      <h1>üè¢ Building Room Map</h1>
      <p>Interactive map showing all hospital rooms and their availability</p>
    </div>

    <div class="container">
      <div class="building-map">
        <div class="floor-selector">
          <button class="floor-btn active" onclick="showFloor(1)">
            Floor 1
          </button>
          <button class="floor-btn" onclick="showFloor(2)">Floor 2</button>
          <button class="floor-btn" onclick="showFloor(3)">Floor 3</button>
        </div>

        <div class="floor-title" id="floorTitle">Ground Floor</div>
        <div class="rooms-grid" id="roomsGrid"></div>
      </div>

      <div class="sidebar">
        <h2>Legend</h2>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color available"></div>
            <span class="legend-text">Available</span>
          </div>
          <div class="legend-item">
            <div class="legend-color occupied"></div>
            <span class="legend-text">Occupied</span>
          </div>
          <div class="legend-item">
            <div class="legend-color icu"></div>
            <span class="legend-text">ICU</span>
          </div>
        </div>

        <div class="room-info">
          <h3 id="selectedRoomTitle">Select a room</h3>
          <p id="selectedRoomType">Click on a room to see details</p>
          <p id="selectedRoomStatus"></p>
        </div>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-label">Total Rooms</div>
            <div class="stat-value" id="totalRooms">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Available</div>
            <div class="stat-value" id="availableCount">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Occupied</div>
            <div class="stat-value" id="occupiedCount">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">ICU</div>
            <div class="stat-value" id="icuCount">0</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const floorData = {
        1: {
          title: "Ground Floor",
          rooms: [101, 102, 103, 104, 105, 106, 107, 108],
        },
        2: {
          title: "First Floor",
          rooms: [201, 202, 203, 204, 205, 206, 207, 208],
        },
        3: {
          title: "Second Floor",
          rooms: [301, 302, 303, 304, 305, 306, 307, 308],
        },
      };

      const roomTypes = {
        101: "Single",
        102: "Double",
        103: "Single",
        104: "Double",
        105: "ICU",
        106: "Single",
        107: "Double",
        108: "Single",
        201: "Single",
        202: "Double",
        203: "ICU",
        204: "Single",
        205: "Double",
        206: "Single",
        207: "ICU",
        208: "Double",
        301: "Single",
        302: "Double",
        303: "Single",
        304: "ICU",
        305: "Double",
        306: "Single",
        307: "Double",
        308: "ICU",
      };

      let currentFloor = 1;
      let allotments = [];

      // Fetch allotments from database
      async function fetchAllotments() {
        try {
          const response = await fetch("php/get_allotments.php");
          const data = await response.json();
          allotments = data;
          console.log("Fetched allotments:", allotments);
          showFloor(1);
        } catch (error) {
          console.error("Error fetching allotments:", error);
          showFloor(1);
        }
      }

      function getRoomStatus(roomId) {
        const today = new Date().toISOString().split("T")[0];
        console.log("Checking room", roomId, "for today", today);
        console.log("Total allotments:", allotments.length);

        const allotmentsForRoom = allotments.filter((a) => {
          console.log(
            "Comparing room_id:",
            a.room_id,
            "with",
            roomId,
            "equal?",
            parseInt(a.room_id) === parseInt(roomId),
          );
          return parseInt(a.room_id) === parseInt(roomId);
        });
        console.log("Allotments for room", roomId, ":", allotmentsForRoom);

        for (let allot of allotmentsForRoom) {
          console.log(
            "Date comparison:",
            allot.allotment_date,
            "===",
            today,
            "?",
            allot.allotment_date === today,
          );
          if (allot.allotment_date === today) {
            return "occupied";
          }
        }
        return "available";
      }

      function showFloor(floor) {
        currentFloor = floor;
        const buttons = document.querySelectorAll(".floor-btn");
        buttons.forEach((btn, index) => {
          btn.classList.remove("active");
          if (index === floor - 1) {
            btn.classList.add("active");
          }
        });

        const data = floorData[floor];
        document.getElementById("floorTitle").textContent = data.title;

        const roomsGrid = document.getElementById("roomsGrid");
        roomsGrid.innerHTML = "";

        const roomsData = [];
        data.rooms.forEach((roomId) => {
          const status = getRoomStatus(roomId);
          const room = { id: roomId, type: roomTypes[roomId], status: status };
          roomsData.push(room);

          const roomEl = document.createElement("div");
          roomEl.className = `room ${status}`;
          roomEl.innerHTML = `
                    <div class="room-number">Room ${roomId}</div>
                    <div class="room-type">${roomTypes[roomId]}</div>
                `;
          roomEl.onclick = () => selectRoom(room, data.title);
          roomsGrid.appendChild(roomEl);
        });

        updateStats(roomsData);
      }

      function selectRoom(room, floor) {
        const statusText =
          room.status.charAt(0).toUpperCase() + room.status.slice(1);
        document.getElementById("selectedRoomTitle").textContent =
          `Room ${room.id}`;
        document.getElementById("selectedRoomType").textContent =
          `Type: ${room.type}`;
        document.getElementById("selectedRoomStatus").textContent =
          `Status: ${statusText}`;
      }

      function updateStats(rooms) {
        const total = rooms.length;
        const available = rooms.filter((r) => r.status === "available").length;
        const occupied = rooms.filter((r) => r.status === "occupied").length;

        document.getElementById("totalRooms").textContent = total;
        document.getElementById("availableCount").textContent = available;
        document.getElementById("occupiedCount").textContent = occupied;
        document.getElementById("icuCount").textContent = rooms.filter(
          (r) => r.type === "ICU",
        ).length;
      }

      // Initialize with floor 1
      fetchAllotments();
    </script>
  </body>
</html>
